<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>
    <div>
        <div class="row">
            <div class="col-xs-12">
                <div>
                    <h1 class="text-center m-b-lg">Chat with GeoAI</h1>
                </div>
                <div class="answer">
                    <div id="chat_window" class="mb-3"></div>
                    <div class="input-group ipt">
                        <div class="col-xs-12">
                            <label>
                                <textarea id="chat_input" class="form-control" rows="1"></textarea>
                            </label>
                        </div>
                        <button id="chat_btn" class="btn btn-primary" type="button">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {  // wait until DOM is ready for execution
        let chat_window = $('#chat_window');
        let chat_btn = $('#chat_btn');
        let chat_input = $('#chat_input');

        function addUserMessage(query) {
            let messageElement =
                $(`<div class = "row message-bubble"><p class = "message-text">${query}</p></div>`);
            chat_window.append(messageElement);
            chat_input.val('');
            chat_window.animate({screenTop: chat_window.prop('scrollHeight')}, 500); // scrollHeight is the height of entire chat window
        }

        function addAIMessage(message) {
            let messageElement =
                $(`<div class = "row message-bubble"><p class = "message-text">${message}</p></div>`);
            chat_window.append(messageElement);
            chat_input.val('');
            chat_window.animate({screenTop: chat_window.prop('scrollHeight')}, 500); // scrollHeight is the height of entire chat window
        }

        chat_btn.click(function () {
            let query = chat_input.val();
            if (query.length === 0) {
                alert("Cannot Enter Empty Message");
                return;
            }
            chat_btn.attr('disabled', true); // button disabled after submission
            addUserMessage(query);

            $.ajax({
                url: '/ai/query',
                method: 'post',
                data: {
                    'query': JSON.stringify(query),
                },
                success: function (response) {
                    response = JSON.parse(response);
                    addAIMessage(response.content);
                    chat_btn.attr('disabled', false);
                },
                error: function (response) {
                    addAIMessage(`<span>Error Encountered</span>`);
                    chat_btn.attr('disabled', false);
                }
            })
        });

        chat_input.keypress(function (k) {
            if (k.which() === 13) {
                chat_btn.click();
            }
        });
    });
</script>
</html>